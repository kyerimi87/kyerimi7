<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4단원 여행 이후의 나</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@700;800&display=swap"
        rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="index.css">
    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>

<body>

    <div class="container">
        <div class="container">
            <!-- Main Menu View (Intro Page) -->
            <div id="view-menu" class="view active" style="flex: 1; display: flex; flex-direction: column;">
                <header id="main-header">
                    <h1 id="page-title">4단원 여행 이후의 나</h1>
                    <p class="subtitle" id="page-subtitle">원하는 프로젝트를 선택하여 활동을 시작하세요.</p>
                </header>

                <div class="menu-grid">
                    <div class="menu-card" onclick="showView('trip-book')">
                        <div class="menu-card-content">
                            <span class="menu-icon">📖</span>
                            <h2>여행 책 만들기</h2>
                            <p>가네의 9단계 교수 설계 모델 기반</p>
                        </div>
                    </div>
                    <div class="menu-card" onclick="showView('bookstore')">
                        <div class="menu-card-content">
                            <span class="menu-icon">🏪</span>
                            <h2>독립서점 운영하기</h2>
                            <p>도서 선정부터 마케팅까지 운영 실습</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trip Book View (Workspace) -->
            <div id="view-trip-book" class="view">
                <div class="workspace-header">
                    <button class="back-btn-compact" onclick="showView('menu')"
                        style="position: absolute; left: 0; top: 0;">🏠 메인</button>
                    <div class="workspace-main-icon">📖</div>
                    <div class="workspace-title-group">
                        <h2 class="workspace-title">나만의 여행 책 만들기</h2>
                        <p class="workspace-subtitle">가네의 9단계 교수 설계 프로젝트</p>
                    </div>
                </div>
                <div class="badge-container" id="badge-display"></div>
                <div class="progress-section" style="margin-bottom: 30px;">
                    <div class="progress-text">프로젝트 성공률: <span id="progress-percent">0</span>%</div>
                    <div class="progress-container">
                        <div id="progress-bar" class="progress-bar"></div>
                    </div>
                </div>
                <main id="steps-container" class="steps-grid"></main>
            </div>

            <!-- Bookstore View (Workspace) -->
            <div id="view-bookstore" class="view">
                <div class="workspace-header">
                    <button class="back-btn-compact" onclick="showView('menu')"
                        style="position: absolute; left: 0; top: 0;">🏠 메인</button>
                    <div class="workspace-main-icon">🏪</div>
                    <div class="workspace-title-group">
                        <h2 class="workspace-title">독립서점 운영하기</h2>
                        <p class="workspace-subtitle">나만의 책을 세상에 선보이는 공간</p>
                    </div>
                </div>

                <div class="bookshelf-view">
                    <div class="hs-activity-label">작가의 책장</div>
                    <h2 style="margin-bottom: 20px;">여러분이 만든 책이 세상과 만나는 공간입니다.</h2>

                    <!-- Book Registration Form -->
                    <div class="registration-form"
                        style="background: white; padding: 25px; border-radius: 20px; box-shadow: var(--shadow); margin-bottom: 40px; text-align: left;">
                        <div class="worksheet-title">✨ 나의 책 등록하기</div>
                        <div class="worksheet-row"
                            style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label class="worksheet-label">책 제목</label>
                                <input type="text" id="reg-title" class="worksheet-text-input" placeholder="제목">
                            </div>
                            <div>
                                <label class="worksheet-label">저자</label>
                                <input type="text" id="reg-author" class="worksheet-text-input" placeholder="이름">
                            </div>
                            <div>
                                <label class="worksheet-label">출판사</label>
                                <input type="text" id="reg-publisher" class="worksheet-text-input" placeholder="출판사명">
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label class="worksheet-label">표지 테마 선택</label>
                            <div class="color-picker" style="display: flex; gap: 10px; margin-top: 5px;">
                                <div class="color-swatch active"
                                    style="background: linear-gradient(135deg, #6366f1, #a855f7);"
                                    onclick="selectColor(this, 'linear-gradient(135deg, #6366f1, #a855f7)')"></div>
                                <div class="color-swatch" style="background: linear-gradient(135deg, #f59e0b, #d97706);"
                                    onclick="selectColor(this, 'linear-gradient(135deg, #f59e0b, #d97706)')"></div>
                                <div class="color-swatch" style="background: linear-gradient(135deg, #10b981, #059669);"
                                    onclick="selectColor(this, 'linear-gradient(135deg, #10b981, #059669)')"></div>
                                <div class="color-swatch" style="background: linear-gradient(135deg, #ef4444, #b91c1c);"
                                    onclick="selectColor(this, 'linear-gradient(135deg, #ef4444, #b91c1c)')"></div>
                                <div class="color-swatch" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"
                                    onclick="selectColor(this, 'linear-gradient(135deg, #3b82f6, #1d4ed8)')"></div>
                            </div>
                        </div>
                        <button class="complete-btn" onclick="registerBook()">책장에 등록하기</button>
                    </div>

                    <div class="shelf">
                        <div class="book-display" id="bookshelf-container">
                            <!-- Books will be injected here -->
                        </div>
                    </div>
                </div>

                <div class="curation-section" style="text-align: center;">
                    <div class="hs-activity-label" style="margin: 0 auto;">여행 북큐레이션</div>
                    <h2 style="margin-top: 20px; font-size: 2.2rem; font-weight: 800;">함께 읽으면 좋은 추천 도서 8선</h2>
                    <p class="subtitle" style="margin-bottom: 40px; text-align: center;">책을 클릭하면 교보문고 도서 정보로 연결됩니다.</p>
                    <div class="curation-grid" id="recommendation-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 35px;">
                        <!-- 8 books will be injected here -->
                    </div>
                </div>
            </div>

            <footer id="page-footer">
                &copy; 2026 4단원 여행 이후의 나 통합 관리 시스템
            </footer>
        </div>

        <script>
            const xmlData = `<?xml version="1.0" encoding="UTF-8"?>
<lessonPlan>
    <title>나만의 여행책 만들기 (Gagné 9 Steps)</title>
    <steps>
        <step id="1">
            <title>주의 집중 (Attention)</title>
            <icon>🎯</icon>
            <description>나의 여행 테마를 정하기 위한 영감 얻기</description>
            <keyQuestion>나의 여행을 한 단어로 표현한다면?</keyQuestion>
            <hsActivity>
                <item>갤러리에서 가장 애착이 가는 사진 한 장 고르기</item>
            </hsActivity>
            <worksheet>선택한 사진에 담긴 당시의 기분과 이 사진을 고른 이유를 적어주세요.</worksheet>
        </step>
        <step id="2">
            <title>학습 목표 (Objective)</title>
            <icon>🚩</icon>
            <description>여행 책의 방향성과 구체적 목표 설정</description>
            <hsActivity>
                <item>여행책의 제목 가안 정하기</item>
            </hsActivity>
            <worksheet>책의 제목과 작가명을 입력하고, 이 책을 통해 독자에게 전달하고 싶은 핵심 메시지를 적어주세요.</worksheet>
            <inputs>
                <input id="book-title" label="책 제목" placeholder="ex. 어느 여름날의 기록"/>
                <input id="book-author" label="작가 명" placeholder="ex. 홍길동"/>
            </inputs>
        </step>
        <step id="3">
            <title>선수 학습 (Prior Recall)</title>
            <icon>🧠</icon>
            <description>과거의 경험과 지식 연결하기</description>
            <hsActivity>
                <item>가장 좋았던 장소와 음식 리스트업</item>
            </hsActivity>
            <worksheet>여행지에서의 오감 중 가장 강렬했던 기억 하나를 서술해 주세요.</worksheet>
        </step>
        <step id="4">
            <title>자극 제시 (Stimulus)</title>
            <icon>✨</icon>
            <description>레이아웃과 디자인 원칙 이해하기</description>
            <hsActivity>
                <item>마음에 드는 폰트 스타일(명조/고딕) 선택하기</item>
            </hsActivity>
            <worksheet>나의 여행 분위기에 가장 잘 어울리는 색조와 폰트 스타일을 선택해 보세요.</worksheet>
        </step>
        <step id="5">
            <title>학습 안내 (Guidance)</title>
            <icon>🗺️</icon>
            <description>스토리텔링 전략 세우기</description>
            <hsActivity>
                <item>시간 중심 vs 테마 중심 구성 방식 결정</item>
            </hsActivity>
            <worksheet>4페이지 분량의 구성을 간단한 스토리보드 형식으로 설명해 주세요.</worksheet>
        </step>
        <step id="6">
            <title>수행 유도 (Performance)</title>
            <icon>🎨</icon>
            <description>실제 여행책 초안 디자인하기</description>
            <hsActivity>
                <item>첫 번째 페이지(표지) 레이아웃 잡기</item>
            </hsActivity>
            <worksheet>제목의 위치와 사진의 배치를 고려한 표지 디자인 구상을 구체적으로 적어주세요.</worksheet>
        </step>
        <step id="7">
            <title>피드백 (Feedback)</title>
            <icon>💬</icon>
            <description>동료와 교사의 의견 수렴 및 수정</description>
            <hsActivity>
                <item>친구에게 나의 레이아웃 보여주고 인상 물어보기</item>
            </hsActivity>
            <worksheet>받은 가장 도움이 된 피드백 한 가지와 수정 계획을 적어주세요.</worksheet>
        </step>
        <step id="8">
            <title>수행 평가 (Assessment)</title>
            <icon>🏆</icon>
            <description>완성도 점검 및 최종 결과물 공유</description>
            <hsActivity>
                <item>학급 갤러리 walk를 통한 결과물 공유</item>
            </hsActivity>
            <worksheet>완성된 여러분의 책에서 가장 만족스러운 부분과 아쉬운 부분을 기록해 보세요.</worksheet>
        </step>
        <step id="9">
            <title>파지 및 전이 (Transfer)</title>
            <icon>🚀</icon>
            <description>경험의 확장과 실제 활용</description>
            <hsActivity>
                <item>실제 인쇄물로 제작할 수 있는 방법 탐색</item>
            </hsActivity>
            <worksheet>이 프로젝트를 마친 후, 일상을 기록하는 방식에 어떤 변화가 생겼나요?</worksheet>
        </step>
    </steps>
    <footer>© 2026 여행 콘텐츠 창작 수업 설계안</footer>
</lessonPlan>`;

            const stepStates = {};
            let registeredBooks = [
                {
                    title: '여행의 이유',
                    author: '김영하',
                    publisher: '문학동네',
                    color: 'linear-gradient(135deg, #3b82f6, #1d4ed8)',
                    image: 'travel_book_cover_1_1768970420580.png'
                }
            ];
            let selectedCoverColor = 'linear-gradient(135deg, #6366f1, #a855f7)';

            const recommendedBooks = [
                { t: "여행의 이유", a: "김영하", p: "문학동네", img: "travel_book_cover_1_1768970420580.png" },
                { t: "소년이 온다", a: "한강", p: "창비", theme: "linear-gradient(135deg, #1e293b, #0f172a)" },
                { t: "불편한 편의점", a: "김호연", p: "나무옆의자", theme: "linear-gradient(135deg, #fef3c7, #fde68a)", dark: true },
                { t: "달러구트 꿈 백화점", a: "이미예", p: "팩토리나인", theme: "linear-gradient(135deg, #4c1d95, #7c3aed)" },
                { t: "데미안", a: "헤르만 헤세", p: "민음사", theme: "linear-gradient(135deg, #064e3b, #065f46)" },
                { t: "어린 왕자", a: "생텍쥐페리", p: "열린책들", img: "travel_book_cover_3_1768970455031.png" },
                { t: "연금술사", a: "파울로 코엘료", p: "문학동네", img: "travel_book_cover_2_1768970436407.png" },
                { t: "지구 끝의 온실", a: "김초엽", p: "자이언트북스", theme: "linear-gradient(135deg, #1e1b4b, #312e81)" }
            ];

            function selectColor(el, color) {
                document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
                el.classList.add('active');
                selectedCoverColor = color;
            }

            function registerBook() {
                const title = document.getElementById('reg-title').value.trim();
                const author = document.getElementById('reg-author').value.trim();
                const publisher = document.getElementById('reg-publisher').value.trim();
                if (!title || !author || !publisher) { alert('모든 정보를 입력해 주세요!'); return; }
                registeredBooks.push({ title, author, publisher, color: selectedCoverColor });
                renderBookshelf();
                document.getElementById('reg-title').value = '';
                document.getElementById('reg-author').value = '';
                document.getElementById('reg-publisher').value = '';
            }

            function updateEverything() {
                const steps = document.querySelectorAll('.step-card');
                let completedCount = 0;
                steps.forEach((step, index) => {
                    const stepId = index + 1;
                    if (stepStates[stepId]) {
                        step.classList.add('completed');
                        document.getElementById(`badge-${stepId}`)?.classList.add('earned');
                        completedCount++;
                    }
                });
                const percent = Math.round((completedCount / steps.length) * 100);
                document.getElementById('progress-bar').style.width = percent + '%';
                document.getElementById('progress-percent').textContent = percent;
                renderBookshelf();
                renderRecommendations();
            }

            function renderRecommendations() {
                const container = document.getElementById('recommendation-grid');
                container.innerHTML = recommendedBooks.map(book => {
                    const hasImage = !!book.img;
                    const style = hasImage ?
                        `background-image: url('${book.img}'); background-size: cover; background-position: center;` :
                        `background: ${book.theme || 'linear-gradient(135deg, #f8fafc, #f1f5f9)'};`;

                    const textColor = book.dark ? '#1e293b' : (hasImage ? 'white' : 'white');
                    const textShadow = hasImage ? 'text-shadow: 0 2px 4px rgba(0,0,0,0.5);' : '';
                    const overlay = hasImage ? '<div style="position:absolute; inset:0; background:rgba(0,0,0,0.2); z-index:1;"></div>' : '';

                    return `
                        <a href="https://search.kyobobook.co.kr/search?keyword=${encodeURIComponent(book.t + ' ' + book.a)}" 
                           target="_blank" class="book-item" 
                           style="${style} position:relative; overflow:hidden;">
                            ${overlay}
                            <div class="book-cover-content" style="position:relative; z-index:2; height:100%; display:flex; flex-direction:column; padding:15px;">
                                <div class="book-cover-title" style="color: ${textColor}; ${textShadow} ${hasImage ? 'font-weight:700;' : ''}">${book.t}</div>
                                <div style="flex: 1; display: flex; align-items: center; justify-content: center; opacity: ${hasImage ? '0' : '0.2'}; font-size: 2.5rem; color: ${textColor};">📖</div>
                                <div class="book-cover-author" style="color: ${textColor}; opacity: 0.9; border-top: 1px solid rgba(255,255,255,0.3); padding-top:10px; ${textShadow}">${book.a}</div>
                            </div>
                        </a>
                    `;
                }).join('');
            }

            function renderBookshelf() {
                const container = document.getElementById('bookshelf-container');
                if (registeredBooks.length > 0) {
                    container.innerHTML = registeredBooks.map(book => `
                    <div class="book-item" style="${book.image ? `background-image: url('${book.image}');` : `background: ${book.color};`}">
                        <div class="book-cover-title" style="${book.image ? 'display:none;' : ''}">${book.title}</div>
                        <div style="${book.image ? 'display:none;' : 'flex: 1; display: flex; align-items: center; justify-content: center; opacity: 0.2; font-size: 2.5rem;'}">📖</div>
                        <div class="book-cover-author" style="${book.image ? 'display:none;' : ''}">${book.author} 씀</div>
                        <div class="book-cover-publisher" style="${book.image ? 'display:none;' : ''}">${book.publisher}</div>
                    </div>
                `).join('');
                } else {
                    container.innerHTML = `<div class="book-item empty-book">작성한 책 정보를 입력하여 등록해 주세요.</div>`;
                }
            }

            function completeStep(stepId, btn) {
                const input = document.getElementById(`input-${stepId}`);
                if (input.value.trim().length < 5) {
                    alert('활동지 내용을 조금 더 자세히 적어주세요! (최소 5자)');
                    return;
                }
                stepStates[stepId] = true;
                btn.textContent = '완료 ✓'; btn.classList.add('active');

                // ✨ Celebrate with confetti
                if (typeof confetti === 'function') {
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#6366f1', '#a855f7', '#f59e0b', '#10b981', '#3b82f6']
                    });
                }

                updateEverything();
                setTimeout(() => {
                    const card = document.querySelector(`.step-card:nth-child(${stepId})`);
                    if (card?.classList.contains('active')) card.classList.remove('active');
                }, 1000);
            }

            function showView(viewName) {
                document.querySelectorAll('.view').forEach(v => {
                    v.classList.remove('active');
                    v.style.display = 'none';
                });

                const view = document.getElementById(`view-${viewName}`);
                view.classList.add('active');

                if (viewName === 'menu') {
                    view.style.display = 'flex';
                } else {
                    view.style.display = 'block';
                }

                if (viewName === 'bookstore') {
                    renderBookshelf();
                    renderRecommendations();
                }

                window.scrollTo(0, 0);
            }

            document.addEventListener('DOMContentLoaded', () => {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlData, "text/xml");
                const steps = xmlDoc.getElementsByTagName("step");
                const container = document.getElementById('steps-container');
                const badgeContainer = document.getElementById('badge-display');

                Array.from(steps).forEach((step, index) => {
                    const id = index + 1;
                    const icon = step.getElementsByTagName("icon")[0].textContent;
                    const title = step.getElementsByTagName("title")[0].textContent;
                    const description = step.getElementsByTagName("description")[0].textContent;
                    const keyQuestion = step.getElementsByTagName("keyQuestion")[0]?.textContent;
                    const hsActivities = Array.from(step.getElementsByTagName("hsActivity")[0]?.getElementsByTagName("item") || []);
                    const worksheetPrompt = step.getElementsByTagName("worksheet")[0].textContent;
                    const hasInputs = step.getElementsByTagName("inputs").length > 0;

                    const badge = document.createElement('div');
                    badge.className = 'badge'; badge.id = `badge-${id}`;
                    badge.innerHTML = `<span class="badge-icon">${icon}</span><span class="badge-label">STEP ${id}</span>`;
                    badgeContainer.appendChild(badge);

                    const card = document.createElement('div');
                    card.className = 'step-card';
                    card.onclick = (e) => { if (!e.target.closest('.worksheet-area')) card.classList.toggle('active'); };

                    let activitiesHtml = hsActivities.map(item => `
                    <div class="hs-activity-item">
                        <div class="activity-checkbox"></div>
                        <span>${item.textContent}</span>
                    </div>
                `).join('');

                    let inputsHtml = hasInputs ? `
                    <div class="worksheet-row" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:10px;">
                        <input type="text" id="input-book-title" class="worksheet-text-input" placeholder="책 제목">
                        <input type="text" id="input-book-author" class="worksheet-text-input" placeholder="작가 명">
                    </div>` : '';

                    card.innerHTML = `
                    <div class="step-header"><div class="step-id">${id}</div><h2 class="step-title">${icon} ${title}</h2></div>
                    <p class="step-description">${description}</p>
                    <div class="detail-content">
                        ${keyQuestion ? `<div class="key-question" style="background:#f0f7ff; border-left:4px solid #6366f1; padding:12px; margin-bottom:15px; border-radius:0 8px 8px 0; font-style:italic;">💡 ${keyQuestion}</div>` : ''}
                        <div class="hs-activity-label">실습 가이드</div>
                        <div class="activity-checkbox-group" style="display:flex; flex-direction:column; gap:8px; margin-bottom:20px;">
                            ${activitiesHtml}
                        </div>
                        <div class="worksheet-area">
                            <div class="worksheet-title" style="font-weight:700; margin-bottom:10px;">✍️ STEP ${id} 활동지</div>
                            <label class="worksheet-label" style="display:block; margin-bottom:10px; font-size:0.9rem; color:#475569;">${worksheetPrompt}</label>
                            ${inputsHtml}
                            <textarea id="input-${id}" class="worksheet-input" placeholder="내용을 입력하세요..." style="width:100%; min-height:100px; padding:15px; border-radius:12px; border:1px solid #e2e8f0; margin-bottom:10px;"></textarea>
                            <button class="complete-btn" onclick="completeStep(${id}, this)">활동 완료</button>
                        </div>
                    </div>`;
                    container.appendChild(card);
                });
                updateEverything();
            });
        </script>
</body>

</html>